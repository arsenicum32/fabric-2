function actionjs(){function n(n,a){function t(n){var r=[0,100,-100,200,400,-300,100];n+1<r.length?n++:n=0,a.flipX=r[n]>a.left,a.animate("left",r[n],{duration:fabric.util.getRandomInt(3e3,5e3),onChange:canvas.renderAll.bind(canvas),onComplete:function(){t(n)},easing:fabric.util.ease[e[fabric.util.getRandomInt(0,e.length)]]})}if("uni"==n)t(0);else if("showboard"==n){var r=0,i=9.8;setInterval(function(){var n=!1;a.top+a.getHeight()/2>=env.nav.vars[4]+canvas.getHeight()&&(a.top=env.nav.vars[4]+canvas.getHeight()-a.getHeight()/2,a.rotate=0,n=!0),n?r=0:r+=.01,a.top+=i*r*r/2,canvas.renderAll()},10)}else"gitar"==n&&(is.not.chrome()&&(canvas.add(new fabric.Text("Попробуйте открыть в хроме!!!",{fontFamily:"Gill Sans"})),changeBackground(1e3,10)),setInterval(function(){a.flipX=!a.flipX},100))}var e=["easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeInElastic","easeOutElastic","easeInOutElastic","easeInBack","easeOutBack","easeInOutBack","easeInBounce","easeOutBounce","easeInOutBounce"];window.ChangeMe=function(e,a,t){nextActionSeeAll(),e.target.visible=!1,canvas.forEachObject(function(e){"I'm"===e.name&&(e.visible=!1,fabric.Image.fromURL(a,function(r){r.scale(.25).originX="center",r.originY="center",r.set({left:e.left,top:e.top,name:e.name,source:a,delifnext:!0}),r.perPixelTargetFind=!0,r.targetFindTolerance=4,n(t,r),canvas.add(r),canvas.renderAll()}))})},window.ChangePerson={up:function(n){if(n.target){var e=findNear(n.target),a=n.target.name;"I'm"==e[1].name&&(e[0]<150&&(PlaySound(a),writesite.run(a)),"macbook"==a&&e[0]<150?(ChangeMe(n,"draws/ars2-02-sprite-2.png",a),movearound()):"uni"==a&&e[0]<150?e[1].source&&"draws/ballsko-01.png"==e[1].source?ChangeMe(n,"draws/ballsko-all.png",a):ChangeMe(n,"draws/ars2-02-sprite.png",a):"gitar"==a&&e[0]<150?ChangeMe(n,"draws/ars3-02.png",a):"showboard"==a&&e[0]<150?ChangeMe(n,"draws/ars3-01.png",a):"balls"==a&&e[0]<150?e[1].source&&"draws/ars2-02-sprite.png"==e[1].source?ChangeMe(n,"draws/ballsko-all.png","uni"):ChangeMe(n,"draws/ballsko-01.png",a):"chess"==a&&e[0]<150?ChangeMe(n,"draws/ars4у-01.png",a):"coffee"==a&&e[0]<150&&ChangeMe(n,"draws/ars4у-02.png",a)),canvas.renderAll()}}},window.eatCompetition={up:function(n){if(n.target){var e=findNear(n.target);n.target.tags&&n.target.tags.indexOf("competency")+1&&"I'm"==e[1].name&&(n.target.visible=!1,n.target.left+=fabric.util.getRandomInt(-200,200),n.target.top+=fabric.util.getRandomInt(-200,200),shakeCanvas(fabric.util.getRandomInt(12,80)))}}},window.shakeCanvas=function(n,e,a){var t=0,r=a||12,i=setInterval(function(){env.nav.vars[3]+=fabric.util.getRandomInt(-r,r),env.nav.vars[4]+=fabric.util.getRandomInt(-r,r),canvas.absolutePan(new fabric.Point(env.nav.vars[3],env.nav.vars[4])),canvas.renderAll(),t++,t>(n||10)&&clearInterval(i)},e||12)},window.movearound=function(n){var e=0,a=setInterval(function(){(n||2)>e?e+=.01:clearInterval(a),t(e)},100),t=function(n){var e=new fabric.Point(0,0),a=.174532925*n;canvas.getObjects().forEach(function(t){var r=new fabric.Point(t.left,t.top),i=fabric.util.rotatePoint(r,e,a);t.top=i.y,t.left=i.x,t.angle=10*n,canvas.renderAll()})}},window.changeBackground=function(n,e,a,t){function r(){return[Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())]}function i(n,e,a){var t=n[0],r=n[1],i=n[2],o=e[0],s=e[1],c=e[2],l=t*(1-a)+o*a,v=r*(1-a)+s*a,e=i*(1-a)+c*a;return[l,v,e]}var o=0,s=0,c=[r(),r()],l=setInterval(function(){var v=n||"Infinity";if(o>v?clearInterval(l):o++,o>=v)canvas.backgroundColor="",canvas.renderAll(),t&&t();else if(e)if(o%e==0&&(a?(s=1-s,c[s]=r()):c[0]=r()),a){var u=i(c[0],c[1],2);canvas.backgroundColor="rgba("+u[0]+","+u[1]+","+u[2]+",1)",canvas.renderAll()}else canvas.backgroundColor="rgba("+c[0][0]+","+c[0][1]+","+c[0][2]+",1)",canvas.renderAll();else canvas.backgroundColor="rgba("+r()[0]+","+r()[1]+","+r()[2]+",1)",canvas.renderAll()},10)}}function audiojs(){window.PlaySound=function(n){var e;if("gitar"==n&&!e&&is.chrome()){var e=new Dancer,a=e.createKick({onKick:function(n){function e(){return[Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random())]}var a=e();canvas.backgroundColor="rgba("+a[0]+","+a[1]+","+a[2]+",1)",canvas.renderAll()},offKick:function(n){}}),t=function(){var n=["hurry","youhowme","fellinlove"];return n[Math.floor(Math.random()*n.length)]}();e.load({src:"audio/"+t,codecs:["mp3"]}),e.play(),console.log(e.isSupported),e.bind("update",function(){for(var n=e.getWaveform(),a=0;a<canvas.getObjects().length;a+=2)canvas.item(a)&&canvas.item(a).left&&(canvas.item(a).left+=n[a]*a),canvas.item(a)&&canvas.item(a).top&&(canvas.item(a).top+=n[a+1]*a),canvas.item(a)&&canvas.item(a).tags&&-1!=canvas.item(a).tags.indexOf("competency")&&canvas.item(a).scale(n[a+2]);canvas.renderAll()}),a.on(),e.after(90,function(){e.unbind("update"),a.off(),canvas.backgroundColor="",e.pause(),e=void 0,window.location.href=""})}}}function canhelpjs(){window.inCanvas=function(n){var e=Ox,a=Ox+canvas.getWidth(),t=Oy,r=Oy+canvas.getHeight(),i=n.width/2,o=n.height/2;return n.left+i<=a&&n.left+i>=e&&n.top+o<=r&&n.top+o>=t},window.nextActionSeeAll=function(){for(var n=0;n<canvas.getObjects().length;n++)canvas.item(n).visible=!0,canvas.item(n).delifnext&&canvas.item(n).remove()},window.findNear=function(n,e){for(var a=n.left,t=n.top,r=e||canvas.getWidth()>canvas.getHeight()?canvas.getWidth():canvas.getHeight(),i=null,o=0;o<canvas.getObjects().length;o++){var s=canvas.item(o).left,c=canvas.item(o).top,l=Math.sqrt((a-s)*(a-s)+(t-c)*(t-c));r>l&&canvas.item(o)!=n&&(r=l,i=canvas.item(o))}return[r,i]},window.makeHandler=function(n,e,a,t){return t?(t.originX="center",t.originY="center",t.animate(n,e,{duration:a||100,onChange:canvas.renderAll.bind(canvas)}),void 0):function(t){t.target&&t.target.tags&&-1==t.target.tags.indexOf("UI")&&(t.target.originX="center",t.target.originY="center",t.target.animate(n,e,{duration:a||100,onChange:canvas.renderAll.bind(canvas)}))}}}function demojs(){function n(n,e){fabric.Image.fromURL(n,function(n){n.scale(.25).originX="center",n.originY="center",n.set(e),n.perPixelTargetFind=!0,n.targetFindTolerance=4,canvas.add(n),canvas.renderAll()})}var e=[{source:"draws/ars-01.png",props:{name:"macbook",tags:[],left:-120,top:-40,angle:12}},{source:"draws/ars-04.png",props:{tags:["competency"],left:fabric.util.getRandomInt(-140,-400),top:fabric.util.getRandomInt(-40,-80),angle:fabric.util.getRandomInt(-30,30)}},{source:"draws/ars-05.png",props:{tags:["competency"],left:fabric.util.getRandomInt(140,400),top:fabric.util.getRandomInt(-140,-180),angle:fabric.util.getRandomInt(-30,30)}},{source:"draws/ars-06.png",props:{tags:["competency"],left:fabric.util.getRandomInt(-140,-400),top:fabric.util.getRandomInt(40,80),angle:fabric.util.getRandomInt(-30,30)}},{source:"draws/ars-07.png",props:{tags:["competency"],left:fabric.util.getRandomInt(140,400),top:fabric.util.getRandomInt(240,-280),angle:fabric.util.getRandomInt(-30,30)}},{source:"draws/ars-08.png",props:{tags:["competency"],left:fabric.util.getRandomInt(-140,400),top:fabric.util.getRandomInt(40,80),angle:fabric.util.getRandomInt(-30,30)}},{source:"draws/ars-09.png",props:{tags:["competency"],left:fabric.util.getRandomInt(140,400),top:fabric.util.getRandomInt(-40,80),angle:fabric.util.getRandomInt(-30,30)}},{source:"draws/ars-10.png",props:{tags:["competency"],left:fabric.util.getRandomInt(140,-400),top:fabric.util.getRandomInt(40,80),angle:fabric.util.getRandomInt(-30,30)}},{source:"draws/ars-11.png",props:{tags:["competency"],left:fabric.util.getRandomInt(140,400),top:fabric.util.getRandomInt(140,180),angle:fabric.util.getRandomInt(-30,30)}},{source:"draws/balls-01.png",props:{name:"balls",tags:[],left:fabric.util.getRandomInt(400,600),top:fabric.util.getRandomInt(-140,-180),angle:fabric.util.getRandomInt(-30,30)}},{source:"draws/ars3-03.png",props:{name:"showboard",tags:[],left:fabric.util.getRandomInt(10,10),top:fabric.util.getRandomInt(240,280),angle:fabric.util.getRandomInt(-30,30)}},{source:"draws/ars3-04.png",props:{name:"gitar",tags:[],html:"hi",left:fabric.util.getRandomInt(400,600),top:fabric.util.getRandomInt(0,80),angle:fabric.util.getRandomInt(-360,360)}},{source:"draws/ars2-03.png",props:{name:"uni",tags:[],left:fabric.util.getRandomInt(-240,-400),top:fabric.util.getRandomInt(-300,-190),angle:fabric.util.getRandomInt(-300,300)}},{source:"draws/ars-02.png",props:{name:"I'm",tags:[]}},{source:"draws/chess.png",props:{name:"chess",tags:[],left:fabric.util.getRandomInt(250,300),top:fabric.util.getRandomInt(0,80),angle:fabric.util.getRandomInt(-30,30)}},{source:"draws/ars4у-04.png",props:{name:"coffee",tags:[],left:fabric.util.getRandomInt(250,300),top:fabric.util.getRandomInt(250,280),angle:fabric.util.getRandomInt(-12,12)}}];for(var a in e)n(e[a].source,e[a].props||{})}function drawpaneljs(){if(is.not.chrome()){var n=new fabric.Rect({left:offsetX,top:offsetY,width:canvas.getWidth(),height:40,fill:"A9DEF9"}),e=new fabric.Text(" куда я попал??? ",{left:offsetX+canvas.getWidth()-180,top:offsetY+10,fontFamily:"Gill Sans",fontSize:20,textBackgroundColor:"black",fill:"0AFFED"});canvas.add(n),canvas.add(e),canvas.renderAll()}}function envjs(){window.env={runner:function(){var n=arguments;return function(e){for(var a in n)"function"==typeof n[a]&&n[a](e)}},nav:{down:function(n){null==canvas.getActiveObject()&&(env.nav.vars[1]=n.e.clientX,env.nav.vars[2]=n.e.clientY,env.nav.vars[0]=!0)},move:function(n){null==canvas.getActiveObject()&&env.nav.vars[0]&&(Math.abs(env.nav.vars[3])>$(window).width()&&(env.nav.vars[3]=-env.nav.vars[3]+env.nav.vars[3]>0?100:-100),Math.abs(env.nav.vars[4])>$(window).height()&&(env.nav.vars[4]=-env.nav.vars[4]+env.nav.vars[4]>0?100:-100),canvas.absolutePan(new fabric.Point(env.nav.vars[3]-n.e.clientX+env.nav.vars[1],env.nav.vars[4]-n.e.clientY+env.nav.vars[2])),Ox=env.nav.vars[3]-n.e.clientX+env.nav.vars[1],Oy=env.nav.vars[4]-n.e.clientY+env.nav.vars[2])},up:function(n){null==canvas.getActiveObject()&&(env.nav.vars[3]-=n.e.clientX-env.nav.vars[1],env.nav.vars[4]-=n.e.clientY-env.nav.vars[2],canvas.absolutePan(new fabric.Point(env.nav.vars[3],env.nav.vars[4])),env.nav.vars[0]=!1)},vars:[!1,0,0,-canvas.getWidth()/2,-canvas.getHeight()/2]},menu:{down:function(n){env.menu.SHOWMENU=!0},move:function(n){env.menu.SHOWMENU=!1},up:function(n){var e=!0;n.target&&env.menu.SHOWMENU&&e&&positM(n.e.clientX,n.e.clientY,$("interface"),n.target)&&(e=!1,$("interface").toggleClass("hid")),env.menu.SHOWMENU&&!$("interface").hasClass("hid")&&e&&(e=!1,$("interface").toggleClass("hid"))},SHOWMENU:!1}};var n={down:function(n){n.target&&(n.target.bringToFront(),n.target.opacity=.5,n.target.hasControls=n.target.hasBorders=!1,canvas.renderAll())},up:function(n){n.target&&(n.target.opacity=1)},over:function(n){makeHandler("scaleX",.35,50)(n),makeHandler("scaleY",.35,50)(n)},out:function(n){makeHandler("scaleX",.25,50)(n),makeHandler("scaleY",.25,50)(n)},moved:function(n){n.target&&(n.target.opacity=.5)},modified:function(n){n.target&&(n.target.opacity=1)}};canvas.on({"mouse:down":env.runner(env.nav.down,env.menu.down,n.down),"mouse:up":env.runner(env.nav.up,env.menu.up,n.up,ChangePerson.up,eatCompetition.up),"mouse:move":env.runner(env.nav.move,env.menu.move),"object:moved":env.runner(n.moved),"object:modified":env.runner(n.modified),"mouse:over":env.runner(n.over),"mouse:out":env.runner(n.out),"touch:gesture":env.runner(),"touch:dragstart":env.runner(),"touch:dragenter":env.runner(),"touch:dragend":env.runner(),"touch:orientation":env.runner(),"touch:shake":env.runner(),"touch:longpress":env.runner(),drop:env.runner(function(){alert("drop")})})}function setup(){function n(){if(1!==window.devicePixelRatio){var n=canvas.getElement(),e=n.width,a=n.height;n.setAttribute("width",e*window.devicePixelRatio),n.setAttribute("height",a*window.devicePixelRatio),n.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio)}canvas.renderAll()}window.canvas=new fabric.Canvas("c"),canvas.setHeight($(window).height()),canvas.setWidth($(window).width()),canvas.selection=!1,canvas.defaultCursor="move",canvas.hoverCursor="pointer",n(),$(window).on("resize",function(){canvas.setHeight($(window).height()),canvas.setWidth($(window).width()),n()}),window.offsetX=-canvas.getWidth()/2,window.offsetY=-canvas.getHeight()/2,canvas.absolutePan(new fabric.Point(offsetX,offsetY))}function setup_info(n){function e(){if(1!==window.devicePixelRatio){var n=info.getElement(),e=n.width,a=n.height;n.setAttribute("width",e*window.devicePixelRatio),n.setAttribute("height",a*window.devicePixelRatio),n.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio)}info.renderAll()}if(window.info=new fabric.Canvas("info"),info.setHeight($("interface").height()),info.setWidth($("interface").width()),info.defaultCursor="move",info.hoverCursor="pointer",e(),$(window).on("resize",function(){info.setHeight($("interface").height()),info.setWidth($("interface").width()),e()}),n)info.loadFromJSON(json,canvas.renderAll.bind(canvas),function(n,e){});else{var a=new fabric.Rect({left:10,top:20,width:120,height:180,fill:"red"});info.add(a),info.renderAll()}info.on({"mouse:down":function(n){if(n.target){var e=["blue","red","yellow","hotpink"][Math.floor(4*Math.random())];n.target.set({borderColor:e,cornerColor:e,cornerSize:.016*$("interface").width(),transparentCorners:!1}),info.renderAll()}}})}!function(){function n(n,e,a){var t=a||$(window),r=t.width(),i=t.height();return[Math.round(n/r),Math.round(e/i)]}window.positM=function(e,a,t,r){t=t||$("interface");var i=[0,0];return n(e,a)[1]&&(i[0]=-t.height()),n(e,a)[0]&&(i[1]=-t.width()),t.css("top",a+i[0]+5+"px"),t.css("left",e+i[1]+5+"px"),console.log(r),r.url?($.get(r.url,function(n){t.html(n)}),t.html("<h2>загрузка...</h2>"),!0):r.html?(t.html(r.html),!0):r.info?(t.html("<canvas id='info'></canvas>"),setup_info(r.info),!0):r.json?($.get(r.json,function(n){t.html("<canvas id='info'></canvas>"),setup_info("string"!=typeof n?n.toString():n)}),!0):!1}}(),function(){var n,e=0,a="",t="<h1>hello, I am Arseniy!</h1><p>programming is cool!!!</p>";window.writesite={run:function(n){"macbook"==n?this.play():this.stop()},setcopy:function(n){t=n},setcopyurl:function(n){$.get(n,function(n){t=n})},play:function(){n=setInterval(function(){e<t.length?e++:clearInterval(n),a=t.substring(0,e),$("#maccode").html(a)},120)},pause:function(){n&&clearInterval(n)},stop:function(){n&&clearInterval(n),e=0,a=""},clear:function(){e=0,a="",$("#maccode").html("")}}}(),function(){setup(),actionjs(),envjs(),canhelpjs(),demojs(),drawpaneljs(),audiojs()}();